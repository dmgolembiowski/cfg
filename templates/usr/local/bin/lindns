#!/bin/sh
#
# Query and update Linode DNS

U='https://api.linode.com/v4'
TOKEN='{{ linode.token }}'

c() {
	local p=$1
	shift
	curl -s "$@" \
		-H 'Accept: application/json' \
		-H 'Content-Type: application/json' \
		-H "Authorization: Bearer $TOKEN" \
		$U/$p
}

id() {
	c domains | jq -r ".data[] | select(.domain == \"$1\") | .id"
}

records() {
	c domains/$(id $1)/records
}

list() {
	records "$@" | jq '.data'
}

get() {
	local d=$1
	shift
	records $d |
		jq ".data[] |
			select(.type==\"$1\") |
			select(.name==\"$2\")"
}

cmd=$1
shift

case "$cmd" in
	list|get)
		$cmd "$@"
		;;
esac
